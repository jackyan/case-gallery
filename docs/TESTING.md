# 测试指南

本文档详细介绍了食堂意见建议平台的测试策略，包括自动化测试运行方法和手动验收清单。

## 1. 自动化测试

项目包含基于 Django `TestCase` 的单元测试和集成测试，覆盖了核心模型约束、业务逻辑和 API 端点。

### 1.1 运行测试

确保已安装项目依赖并激活虚拟环境：

```bash
# 运行所有测试
./venv/bin/python manage.py test

# 仅运行核心应用的测试
./venv/bin/python manage.py test core

# 增加详细输出
./venv/bin/python manage.py test core -v 2
```

### 1.2 测试覆盖范围

*   **Models (模型层)**:
    *   `FoodItem`: 验证创建和字段默认值。
    *   `Vote`: 验证 `unique_together` 约束，确保单 IP 单日单菜品不重复投票。
*   **Views & APIs (视图层)**:
    *   `GET /api/rankings/`: 验证 JSON 数据结构正确性。
    *   `POST /api/vote/`: 验证投票成功流程、重复投票拦截逻辑。
    *   `POST /api/suggestion/`: 验证建议提交和数据持久化。

---

## 2. 手动验收测试 (UAT)

在部署或发布新版本前，建议按照以下清单进行手动验证。

### 2.1 首页与排行榜
- [ ] **加载速度**: 页面能在 2 秒内加载完成。
- [ ] **数据显示**: 早餐、午餐、晚餐三个板块分别显示对应的 Top 菜品。
- [ ] **票数更新**: 投票后刷新页面，对应菜品的票数应 +1。
- [ ] **词云展示**: 底部词云区域正常渲染，无重叠或显示错误。

### 2.2 投票功能
- [ ] **Tab 切换**: 点击早/中/晚标签，流畅切换菜品列表。
- [ ] **图片加载**: 所有菜品图片（或占位符）正常显示，无破图。
- [ ] **正常投票**: 点击"投票"按钮，出现成功的 Toast 提示。
- [ ] **重复投票**: 不刷新页面再次点击同一菜品的投票按钮，出现错误提示（"您今天已经...").
- [ ] **跨天测试**: 修改系统时间或数据库日期，验证第二天能否重新投票。

### 2.3 意见/建议提交
- [ ] **表单验证**:
    - [ ] 提交空内容，提示错误。
    - [ ] 提交超长内容 (>1000字)，提示错误或被截断。
- [ ] **类别选择**: 能正确选择"投诉"、"建议"、"表扬"。
- [ ] **提交成功**: 提交后显示成功页面，并提供"继续提交"和"返回首页"按钮。

### 2.4 移动端兼容性
- [ ] **iPhone/Android**: 使用手机浏览器打开，布局无错乱。
- [ ] **导航栏**: 在小屏幕下导航链接点击正常。
- [ ] **触摸反馈**: 按钮和卡片有点击态。

### 2.5 管理后台
- [ ] **登录**: 管理员能否正常登录 `/admin/`。
- [ ] **筛选**: 建议列表能否按"未处理"筛选。
- [ ] **数据修改**: 能否手动停用某个 `FoodItem`。

---

## 3. 性能测试建议

对于生产环境，建议使用 `Locust` 进行简单的负载测试。

**安装 Locust**:
```bash
pip install locust
```

**编写 locustfile.py**:
```python
from locust import HttpUser, task, between

class WebsiteUser(HttpUser):
    wait_time = between(1, 5)

    @task(3)
    def view_homepage(self):
        self.client.get("/")

    @task(1)
    def view_rankings(self):
        self.client.get("/api/rankings/")
```

**运行测试**:
```bash
locust -f locustfile.py
```
访问 `http://localhost:8089` 查看测试报告。
